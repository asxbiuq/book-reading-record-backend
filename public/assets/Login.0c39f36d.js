import{g as y,V as k,o as _,b as h,w as E,a as f,W as v,k as L,E as T,j as d,f as x,X as A,Y as P,h as m,D as S,p,s as j,Z as D,z as w,A as I,B as N,C as U}from"./index.1b68d483.js";import{a as V}from"./assign.8ac48471.js";const z=d("div",{class:"flex justify-between w-full"},[d("span",null,[d("input",{type:"checkbox",checked:"checked",name:"remember"}),x(" \u8BB0\u4F4F\u5BC6\u7801 ")]),d("a",{href:"#"},"\u5FD8\u8BB0\u5BC6\u7801?")],-1),M=y({__name:"LoginForm",props:{email:null,password:null,delay:null},emits:["login","update:email","update:password"],setup(o,{emit:u}){const s=k(()=>{u("login")},o.delay);return(r,e)=>{const t=A,n=P;return _(),h(n,{"form-label":"\u767B\u9646","btn-name":"\u767B\u9646",onSubmit:e[4]||(e[4]=L(a=>T(s)(a),["prevent"]))},{default:E(()=>[f(t,{data:o.email,"onUpdate:data":e[0]||(e[0]=a=>v(email)?email.value=a:null),placeholder:"\u90AE\u7BB1",reg:/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,type:"email","data-tip":"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1",value:o.email,onInput:e[1]||(e[1]=a=>r.$emit("update:email",a.target.value))},null,8,["data","reg","value"]),f(t,{data:o.password,"onUpdate:data":e[2]||(e[2]=a=>v(password)?password.value=a:null),placeholder:"\u5BC6\u7801",type:"password",value:o.password,reg:/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]{6,20}$/,"data-tip":"\u5BC6\u7801\u81F3\u5C11\u5305\u542B \u6570\u5B57\u548C\u82F1\u6587,\u957F\u5EA66-20",onInput:e[3]||(e[3]=a=>r.$emit("update:password",a.target.value))},null,8,["data","value","reg"]),z]),_:1})}}});let B={token:"",userId:"",name:"",expiryDate:""};const R=o=>{let u=m(null),s=m(!1);return{error:u,login:async(e,t)=>{if(u.value=null,s.value=!0,!(e||t))throw new Error(`email : ${e!=null?e:null}, password: ${t!=null?t:null}`);try{const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(n.status!==200&&n.status!==201){const a=await n.json();throw new Error(a.message)}return B=await n.json(),u.value=null,s.value=!1,B}catch(n){u.value=n.message,s.value=!1}},isPending:s}},Z=y({__name:"Login",setup(o){const u=m(""),s=m(""),r="https://express-aliyun-backend-jaiygpwyhp.cn-shanghai.fcapp.run/auth/login",e=S(),t=I(),n=R(r),a=p(n,"error"),$=p(n,"login");let F=j();D(()=>{F.value=!0});const b=async()=>{t.value.isPending=!0;const c=N(),l=p(c,"open"),g=p(c,"close");l.value();const i=await $.value(u.value,s.value);if(!a.value)V(t.value,i),e.push("/");else{const C=U();p(C,"open").value(a.value)}g.value(),t.value.isPending=!1};return(c,l)=>{const g=M;return _(),h(g,{email:u.value,"onUpdate:email":l[0]||(l[0]=i=>u.value=i),password:s.value,"onUpdate:password":l[1]||(l[1]=i=>s.value=i),novalidate:"",delay:1e3,onLogin:b,class:"form",isPending:t.value.isPending},null,8,["email","password","isPending"])}}});typeof w=="function"&&w(Z);export{Z as default};
