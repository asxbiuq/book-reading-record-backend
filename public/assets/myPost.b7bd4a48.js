import{Q as O,p as j,h as L,R as Q,m as a,P as E,T as W,B as $,_ as X,g as Y,N as Z,q as K,E as ee,U as te,D as F,V as se,W as ae,X as oe,o as h,c as y,j as f,F as S,x as ne,a as x,e as le,y as I,z as N,G as ce,C,J as ue,H as ie,I as re,Y as de,Z as _e,$ as pe,a0 as ve}from"./index.5403ae4c.js";const me=O("myPost",()=>{const _="https://my-32541.herokuapp.com/post",p=$();j();const t=L([]),v=async(i=1)=>{const c=Q(_,p.value.token),o=a(c,"useGets");a(c,"useDelete"),a(c,"usePut"),m();const g=await o.value(`/myposts/${i}`).json(),r=a(g,"data");if(r.value.posts.length)m(),r.value.posts.forEach(k=>{t.value.push(k)});else throw new Error("\u6CA1\u6709\u66F4\u591A\u7684\u6570\u636E\u4E86!")},P=async i=>{const c=t.value.map(o=>(o._id==i._id&&(o.isFav=!0),o));E(t.value,c)},B=async i=>{const c=t.value.map(o=>(o._id===i._id&&(o.isFav=!1),o));E(t.value,c)},m=()=>{W(t.value,i=>!0)};return{myPosts:t,getMyPosts:v,deleteMyPostFav:B,addMyPostFav:P}});const U=_=>(pe("data-v-322ec03d"),_=_(),ve(),_),ge=U(()=>f("div",{id:"top"},null,-1)),he={ref:"el",class:"relative top-[5rem]"},ye={key:0,class:"flex justify-center"},fe={class:"flex flex-col gap-10 justify-center"},Pe={key:0},we={key:1},Fe=U(()=>f("p",null,"\u8BF7\u767B\u5F55",-1)),xe=[Fe],b=Y({__name:"myPost",setup(_){const p=L(null),t=$(),v=Z(),P=a(v,"getPosts"),B=a(v,"deletePost");a(v,"UpdatePost"),a(v,"clearPosts"),j();const m=ce();let i=K();const{addFav:c,deleteFav:o}=ee(),g=me(),r=a(g,"myPosts"),k=a(g,"getMyPosts"),A=a(g,"deleteMyPostFav"),G=a(g,"addMyPostFav");if(te(r,()=>{console.log("myPosts: ",r.value)}),new Date(t.value.expiryDate).getTime()-new Date().getTime()<0){const{open:e}=F();e("\u767B\u9646\u8BA4\u8BC1\u5DF2\u5931\u6548,\u8BF7\u91CD\u65B0\u767B\u9646"),m.push({name:"Login"})}const M=async()=>{await k.value()};t.value.token||m.push({name:"Login"}),r.value.length||M();const V=async e=>{const{open:s,close:l}=C();s(),t.value.isPending=!0;try{await B.value(e._id)}catch(u){console.log(u);const{open:w}=F();w(u)}t.value.isPending=!1,l()},R=async e=>{const{open:s,close:l}=C();s(),t.value.isPending=!0;try{e.isFav?(await o(e),await A.value(e)):(await c(e),await G.value(e))}catch(u){console.log(u);const{open:w}=F();w(u)}t.value.isPending=!1,l()},z=e=>{const s=$();s.value.postId=e._id,m.push({name:"Comments",params:{id:e._id}})};se(()=>{if(p.value)ae(p.value);else throw new Error(`target is ${p.value||null}`)});const T=ue(()=>{i.value=!0},1e3);let d=1;oe(()=>999);const q=async()=>{const{open:e,close:s}=C();e();try{d++,await P.value(d)}catch(l){d--,await P.value(d),console.log(l);const{open:u}=F();u(l)}s()},H=async()=>{const{open:e,close:s}=C();if(e(),d<=1){console.log("The first page!");const{open:l}=F();l("\u5DF2\u7ECF\u662F\u7B2C\u4E00\u9875!")}else d--,await P.value(d),console.log("CurrentPage:",d);s()};return(e,s)=>{const l=ie,u=re,w=de,J=_e;return h(),y(S,null,[ge,f("div",he,[t.value.token?(h(),y("div",ye,[f("ul",fe,[(h(!0),y(S,null,ne(r.value,n=>(h(),y("li",{key:n._id},[x(l,{title:n.title,author:n.author,description:n.content,"btn-name":"\u5220\u9664","img-url":n.imageUrl,"is-fav":n.isFav,onClickBtn:D=>V(n),onClickStar:D=>R(n),onClickImage:D=>z(n),class:"book-card hover:scale-105 duration-200 drop-shadow-2xl shadow-2xl bg-blend-color-burn"},null,8,["title","author","description","img-url","is-fav","onClickBtn","onClickStar","onClickImage"])]))),128)),r.value.length!==0?(h(),y("div",Pe,[x(u,{onPagePre:H,onPageNext:q})])):le("",!0)]),f("div",{ref_key:"target",ref:p,class:"flex justify-center bottom-6 fixed"},[x(w,{onCreated:M})],512)])):(h(),y("div",we,xe))],512),f("div",{class:"fixed bottom-5 right-5 hover:text-blue-700 cursor-pointer click",onClick:s[0]||(s[0]=(...n)=>I(T)&&I(T)(...n))},[x(J,{style:{"font-size":"2em"}})])],64)}}});typeof N=="function"&&N(b);var Be=X(b,[["__scopeId","data-v-322ec03d"]]);export{Be as default};
